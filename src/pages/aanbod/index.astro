---
import Layout from '../../layouts/Layout.astro';
import { AanbodPage } from '../../components/AanbodPage';
import type { Car } from '../../data/cars';
import { mockCars } from '../../data/cars';
import { transformApiListingsToCars } from '../../utils/api-listing-to-car';

let cars: Car[] = [];

try {
  const baseUrl = Astro.url.origin;
  const apiUrl = `${baseUrl}/api/listings.json`;
  const response = await fetch(apiUrl);

  if (response.ok) {
    const data = await response.json();
    cars = transformApiListingsToCars(data.listings);
  }
  if (cars.length === 0) {
    cars = mockCars;
  }
} catch (error) {
  console.error('Error fetching cars from API:', error);
  cars = mockCars;
}
---

<Layout title="Ons aanbod â€“ Steven Car Company BV" description="Onze actuele voorraad jonge occasions. Zorgvuldig geselecteerd, eerlijk geprijsd. Kom gerust langs op afspraak of bel voor meer info.">
  <AanbodPage cars={cars} client:load />
</Layout>
